{"ast":null,"code":"/**\n * Module requirements.\n */\n\nvar Polling = require('./polling');\nvar inherit = require('component-inherit');\n\n/**\n * Module exports.\n */\n\nmodule.exports = JSONPPolling;\n\n/**\n * Cached regular expressions.\n */\n\nvar rNewline = /\\n/g;\nvar rEscapedNewline = /\\\\n/g;\n\n/**\n * Global JSONP callbacks.\n */\n\nvar callbacks;\n\n/**\n * Callbacks count.\n */\n\nvar index = 0;\n\n/**\n * Noop.\n */\n\nfunction empty() {}\n\n/**\n * JSONP Polling constructor.\n *\n * @param {Object} opts.\n * @api public\n */\n\nfunction JSONPPolling(opts) {\n  Polling.call(this, opts);\n  this.query = this.query || {};\n\n  // define global callbacks array if not present\n  // we do this here (lazily) to avoid unneeded global pollution\n  if (!callbacks) {\n    // we need to consider multiple engines in the same page\n    if (!global.___eio) global.___eio = [];\n    callbacks = global.___eio;\n  }\n\n  // callback identifier\n  this.index = callbacks.length;\n\n  // add callback to jsonp global\n  var self = this;\n  callbacks.push(function (msg) {\n    self.onData(msg);\n  });\n\n  // append to query string\n  this.query.j = this.index;\n\n  // prevent spurious errors from being emitted when the window is unloaded\n  if (global.document && global.addEventListener) {\n    global.addEventListener('beforeunload', function () {\n      if (self.script) self.script.onerror = empty;\n    });\n  }\n}\n\n/**\n * Inherits from Polling.\n */\n\ninherit(JSONPPolling, Polling);\n\n/*\n * JSONP only supports binary as base64 encoded strings\n */\n\nJSONPPolling.prototype.supportsBinary = false;\n\n/**\n * Closes the socket.\n *\n * @api private\n */\n\nJSONPPolling.prototype.doClose = function () {\n  if (this.script) {\n    this.script.parentNode.removeChild(this.script);\n    this.script = null;\n  }\n  if (this.form) {\n    this.form.parentNode.removeChild(this.form);\n    this.form = null;\n  }\n  Polling.prototype.doClose.call(this);\n};\n\n/**\n * Starts a poll cycle.\n *\n * @api private\n */\n\nJSONPPolling.prototype.doPoll = function () {\n  var self = this;\n  var script = document.createElement('script');\n  if (this.script) {\n    this.script.parentNode.removeChild(this.script);\n    this.script = null;\n  }\n  script.async = true;\n  script.src = this.uri();\n  script.onerror = function (e) {\n    self.onError('jsonp poll error', e);\n  };\n  var insertAt = document.getElementsByTagName('script')[0];\n  insertAt.parentNode.insertBefore(script, insertAt);\n  this.script = script;\n  var isUAgecko = 'undefined' != typeof navigator && /gecko/i.test(navigator.userAgent);\n  if (isUAgecko) {\n    setTimeout(function () {\n      var iframe = document.createElement('iframe');\n      document.body.appendChild(iframe);\n      document.body.removeChild(iframe);\n    }, 100);\n  }\n};\n\n/**\n * Writes with a hidden iframe.\n *\n * @param {String} data to send\n * @param {Function} called upon flush.\n * @api private\n */\n\nJSONPPolling.prototype.doWrite = function (data, fn) {\n  var self = this;\n  if (!this.form) {\n    var form = document.createElement('form');\n    var area = document.createElement('textarea');\n    var id = this.iframeId = 'eio_iframe_' + this.index;\n    var iframe;\n    form.className = 'socketio';\n    form.style.position = 'absolute';\n    form.style.top = '-1000px';\n    form.style.left = '-1000px';\n    form.target = id;\n    form.method = 'POST';\n    form.setAttribute('accept-charset', 'utf-8');\n    area.name = 'd';\n    form.appendChild(area);\n    document.body.appendChild(form);\n    this.form = form;\n    this.area = area;\n  }\n  this.form.action = this.uri();\n  function complete() {\n    initIframe();\n    fn();\n  }\n  function initIframe() {\n    if (self.iframe) {\n      try {\n        self.form.removeChild(self.iframe);\n      } catch (e) {\n        self.onError('jsonp polling iframe removal error', e);\n      }\n    }\n    try {\n      // ie6 dynamic iframes with target=\"\" support (thanks Chris Lambacher)\n      var html = '<iframe src=\"javascript:0\" name=\"' + self.iframeId + '\">';\n      iframe = document.createElement(html);\n    } catch (e) {\n      iframe = document.createElement('iframe');\n      iframe.name = self.iframeId;\n      iframe.src = 'javascript:0';\n    }\n    iframe.id = self.iframeId;\n    self.form.appendChild(iframe);\n    self.iframe = iframe;\n  }\n  initIframe();\n\n  // escape \\n to prevent it from being converted into \\r\\n by some UAs\n  // double escaping is required for escaped new lines because unescaping of new lines can be done safely on server-side\n  data = data.replace(rEscapedNewline, '\\\\\\n');\n  this.area.value = data.replace(rNewline, '\\\\n');\n  try {\n    this.form.submit();\n  } catch (e) {}\n  if (this.iframe.attachEvent) {\n    this.iframe.onreadystatechange = function () {\n      if (self.iframe.readyState == 'complete') {\n        complete();\n      }\n    };\n  } else {\n    this.iframe.onload = complete;\n  }\n};","map":{"version":3,"names":["Polling","require","inherit","module","exports","JSONPPolling","rNewline","rEscapedNewline","callbacks","index","empty","opts","call","query","global","___eio","length","self","push","msg","onData","j","document","addEventListener","script","onerror","prototype","supportsBinary","doClose","parentNode","removeChild","form","doPoll","createElement","async","src","uri","e","onError","insertAt","getElementsByTagName","insertBefore","isUAgecko","navigator","test","userAgent","setTimeout","iframe","body","appendChild","doWrite","data","fn","area","id","iframeId","className","style","position","top","left","target","method","setAttribute","name","action","complete","initIframe","html","replace","value","submit","attachEvent","onreadystatechange","readyState","onload"],"sources":["/home/y4n/node_modules/engine.io-client/lib/transports/polling-jsonp.js"],"sourcesContent":["\n/**\n * Module requirements.\n */\n\nvar Polling = require('./polling');\nvar inherit = require('component-inherit');\n\n/**\n * Module exports.\n */\n\nmodule.exports = JSONPPolling;\n\n/**\n * Cached regular expressions.\n */\n\nvar rNewline = /\\n/g;\nvar rEscapedNewline = /\\\\n/g;\n\n/**\n * Global JSONP callbacks.\n */\n\nvar callbacks;\n\n/**\n * Callbacks count.\n */\n\nvar index = 0;\n\n/**\n * Noop.\n */\n\nfunction empty () { }\n\n/**\n * JSONP Polling constructor.\n *\n * @param {Object} opts.\n * @api public\n */\n\nfunction JSONPPolling (opts) {\n  Polling.call(this, opts);\n\n  this.query = this.query || {};\n\n  // define global callbacks array if not present\n  // we do this here (lazily) to avoid unneeded global pollution\n  if (!callbacks) {\n    // we need to consider multiple engines in the same page\n    if (!global.___eio) global.___eio = [];\n    callbacks = global.___eio;\n  }\n\n  // callback identifier\n  this.index = callbacks.length;\n\n  // add callback to jsonp global\n  var self = this;\n  callbacks.push(function (msg) {\n    self.onData(msg);\n  });\n\n  // append to query string\n  this.query.j = this.index;\n\n  // prevent spurious errors from being emitted when the window is unloaded\n  if (global.document && global.addEventListener) {\n    global.addEventListener('beforeunload', function () {\n      if (self.script) self.script.onerror = empty;\n    });\n  }\n}\n\n/**\n * Inherits from Polling.\n */\n\ninherit(JSONPPolling, Polling);\n\n/*\n * JSONP only supports binary as base64 encoded strings\n */\n\nJSONPPolling.prototype.supportsBinary = false;\n\n/**\n * Closes the socket.\n *\n * @api private\n */\n\nJSONPPolling.prototype.doClose = function () {\n  if (this.script) {\n    this.script.parentNode.removeChild(this.script);\n    this.script = null;\n  }\n\n  if (this.form) {\n    this.form.parentNode.removeChild(this.form);\n    this.form = null;\n  }\n\n  Polling.prototype.doClose.call(this);\n};\n\n/**\n * Starts a poll cycle.\n *\n * @api private\n */\n\nJSONPPolling.prototype.doPoll = function () {\n  var self = this;\n  var script = document.createElement('script');\n\n  if (this.script) {\n    this.script.parentNode.removeChild(this.script);\n    this.script = null;\n  }\n\n  script.async = true;\n  script.src = this.uri();\n  script.onerror = function(e){\n    self.onError('jsonp poll error',e);\n  };\n\n  var insertAt = document.getElementsByTagName('script')[0];\n  insertAt.parentNode.insertBefore(script, insertAt);\n  this.script = script;\n\n  var isUAgecko = 'undefined' != typeof navigator && /gecko/i.test(navigator.userAgent);\n  \n  if (isUAgecko) {\n    setTimeout(function () {\n      var iframe = document.createElement('iframe');\n      document.body.appendChild(iframe);\n      document.body.removeChild(iframe);\n    }, 100);\n  }\n};\n\n/**\n * Writes with a hidden iframe.\n *\n * @param {String} data to send\n * @param {Function} called upon flush.\n * @api private\n */\n\nJSONPPolling.prototype.doWrite = function (data, fn) {\n  var self = this;\n\n  if (!this.form) {\n    var form = document.createElement('form');\n    var area = document.createElement('textarea');\n    var id = this.iframeId = 'eio_iframe_' + this.index;\n    var iframe;\n\n    form.className = 'socketio';\n    form.style.position = 'absolute';\n    form.style.top = '-1000px';\n    form.style.left = '-1000px';\n    form.target = id;\n    form.method = 'POST';\n    form.setAttribute('accept-charset', 'utf-8');\n    area.name = 'd';\n    form.appendChild(area);\n    document.body.appendChild(form);\n\n    this.form = form;\n    this.area = area;\n  }\n\n  this.form.action = this.uri();\n\n  function complete () {\n    initIframe();\n    fn();\n  }\n\n  function initIframe () {\n    if (self.iframe) {\n      try {\n        self.form.removeChild(self.iframe);\n      } catch (e) {\n        self.onError('jsonp polling iframe removal error', e);\n      }\n    }\n\n    try {\n      // ie6 dynamic iframes with target=\"\" support (thanks Chris Lambacher)\n      var html = '<iframe src=\"javascript:0\" name=\"'+ self.iframeId +'\">';\n      iframe = document.createElement(html);\n    } catch (e) {\n      iframe = document.createElement('iframe');\n      iframe.name = self.iframeId;\n      iframe.src = 'javascript:0';\n    }\n\n    iframe.id = self.iframeId;\n\n    self.form.appendChild(iframe);\n    self.iframe = iframe;\n  }\n\n  initIframe();\n\n  // escape \\n to prevent it from being converted into \\r\\n by some UAs\n  // double escaping is required for escaped new lines because unescaping of new lines can be done safely on server-side\n  data = data.replace(rEscapedNewline, '\\\\\\n');\n  this.area.value = data.replace(rNewline, '\\\\n');\n\n  try {\n    this.form.submit();\n  } catch(e) {}\n\n  if (this.iframe.attachEvent) {\n    this.iframe.onreadystatechange = function(){\n      if (self.iframe.readyState == 'complete') {\n        complete();\n      }\n    };\n  } else {\n    this.iframe.onload = complete;\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}